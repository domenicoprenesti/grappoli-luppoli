<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Fix Confronto ID</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8">ğŸ§ª Test: Confronto ID (Number vs String)</h1>

        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">ğŸ“Š Simulazione Problema</h2>
            <button onclick="testConfronto()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium">
                ğŸš€ Esegui Test
            </button>
        </div>

        <div id="risultati" class="space-y-4"></div>
    </div>

    <script>
        function mostraRisultato(titolo, contenuto, tipo = 'info') {
            const risultatiDiv = document.getElementById('risultati');
            const colore = tipo === 'success' ? 'green' : tipo === 'error' ? 'red' : 'blue';
            const icona = tipo === 'success' ? 'âœ…' : tipo === 'error' ? 'âŒ' : 'â„¹ï¸';
            
            risultatiDiv.innerHTML += `
                <div class="bg-${colore}-50 border-l-4 border-${colore}-500 rounded-lg p-6">
                    <h3 class="font-bold text-${colore}-900 text-lg mb-2">${icona} ${titolo}</h3>
                    <div class="text-sm text-${colore}-800 font-mono whitespace-pre-wrap">
${contenuto}
                    </div>
                </div>
            `;
        }

        function testConfronto() {
            document.getElementById('risultati').innerHTML = '';
            
            // SIMULA DATI DATABASE (con ID numerici come Supabase)
            const aggregantiDB = [
                { id: 1, nome: 'Vini' },
                { id: 2, nome: 'Birre' },
                { id: 8, nome: 'Ricorrenti' }
            ];

            const tipiDB = [
                { id: 101, nome: 'Vini Rossi', aggregante_id: 1 },
                { id: 102, nome: 'Vini Bianchi', aggregante_id: 1 },
                { id: 201, nome: 'Birra Chiara', aggregante_id: 2 },
                { id: 801, nome: 'Consumabili', aggregante_id: 8 },
                { id: 802, nome: 'Ghiaccio', aggregante_id: 8 },
                { id: 803, nome: 'Merchandising', aggregante_id: 8 },
                { id: 804, nome: 'Minchiate', aggregante_id: 8 },
                { id: 805, nome: 'Omaggio', aggregante_id: 8 }
            ];

            // SIMULA SELECT HTML (restituisce SEMPRE string!)
            const aggreganteIdDaSelect = "8"; // String!

            console.log('ğŸ“Š Dati di test:');
            console.log('  Aggreganti:', aggregantiDB);
            console.log('  Tipi:', tipiDB);
            console.log('  ID selezionato da dropdown:', aggreganteIdDaSelect, typeof aggreganteIdDaSelect);

            // TEST 1: CONFRONTO CON === (SBAGLIATO)
            console.log('\nâŒ TEST 1: Con === (strict equality)');
            const tipiFiltrati_SBAGLIATO = tipiDB.filter(t => {
                const match = t.aggregante_id === aggreganteIdDaSelect;
                console.log(`  ${t.nome}: ${t.aggregante_id} === "${aggreganteIdDaSelect}" â†’ ${match}`);
                return match;
            });

            mostraRisultato(
                'TEST 1: Confronto con === (SBAGLIATO)',
                `Codice:
const tipiFiltrati = tipiDB.filter(t => 
    t.aggregante_id === aggreganteIdDaSelect
);

ID dal database: ${8} (type: number)
ID dal select HTML: "${aggreganteIdDaSelect}" (type: string)

Confronto: 8 === "8" â†’ FALSE âŒ

Risultato:
Tipi trovati: ${tipiFiltrati_SBAGLIATO.length}
${tipiFiltrati_SBAGLIATO.length === 0 ? 'âš ï¸ NESSUN TIPO TROVATO - DROPDOWN VUOTO!' : tipiFiltrati_SBAGLIATO.map(t => '  â€¢ ' + t.nome).join('\n')}`,
                'error'
            );

            // TEST 2: CONFRONTO CON == (CORRETTO)
            console.log('\nâœ… TEST 2: Con == (loose equality)');
            const tipiFiltrati_CORRETTO = tipiDB.filter(t => {
                const match = t.aggregante_id == aggreganteIdDaSelect; // == invece di ===
                console.log(`  ${t.nome}: ${t.aggregante_id} == "${aggreganteIdDaSelect}" â†’ ${match}`);
                return match;
            });

            mostraRisultato(
                'TEST 2: Confronto con == (CORRETTO)',
                `Codice:
const tipiFiltrati = tipiDB.filter(t => 
    t.aggregante_id == aggreganteIdDaSelect
);

ID dal database: ${8} (type: number)
ID dal select HTML: "${aggreganteIdDaSelect}" (type: string)

Confronto: 8 == "8" â†’ TRUE âœ…

Risultato:
Tipi trovati: ${tipiFiltrati_CORRETTO.length}
${tipiFiltrati_CORRETTO.map(t => '  â€¢ ' + t.nome).join('\n')}

ğŸ‰ TUTTI I TIPI VISUALIZZATI CORRETTAMENTE!`,
                'success'
            );

            // TEST 3: DIMOSTRAZIONE VISIVA
            const demo = `
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  PERCHÃ‰ IL DROPDOWN ERA VUOTO                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1ï¸âƒ£ DATABASE (Supabase):
   aggregante_id = 8 (INTEGER/NUMBER)

2ï¸âƒ£ HTML SELECT:
   <select id="prodottoAggregante">
     <option value="8">Ricorrenti</option>  â† STRINGA "8"
   </select>

3ï¸âƒ£ JAVASCRIPT:
   const id = select.value;  // â†’ "8" (STRING!)

4ï¸âƒ£ CONFRONTO:
   
   âŒ CON ===:
      8 === "8"  â†’ FALSE
      Tipi filtrati: [ ] (vuoto)
      Dropdown: solo "+ Crea nuovo tipo"
   
   âœ… CON ==:
      8 == "8"  â†’ TRUE (conversione automatica)
      Tipi filtrati: [Consumabili, Ghiaccio, ...]
      Dropdown: tutti i tipi! ğŸ‰

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  REGOLA D'ORO                                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  Quando confronti dati da DATABASE con SELECT HTML:      â•‘
â•‘  â†’ USA == (loose equality)                                â•‘
â•‘  â†’ NON usare === (strict equality)                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`;

            mostraRisultato(
                'Spiegazione Visiva',
                demo,
                'info'
            );
        }

        console.log('ğŸ”§ Test pronto. Clicca il pulsante per eseguire!');
    </script>
</body>
</html>
